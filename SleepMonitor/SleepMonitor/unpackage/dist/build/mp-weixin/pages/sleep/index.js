"use strict";const t=require("../../common/vendor.js"),e={components:{AudioRecorder:()=>"../../components/audio-recorder/audio-recorder.js"},data:()=>({isDarkTheme:!1,currentTime:"",charts:{},chartData:{heartRate:{times:[],values:[]},breathingRate:{times:[],values:[]},temperature:{times:[],values:[]},snore:{times:[],values:[]}},timer:null,totalHours:24,displayHours:8,startTimeIndex:0}),onLoad(){this.updateTime(),this.timer=setInterval(this.updateTime,1e3),this.loadData()},onReady(){setTimeout((()=>{const t=document.createElement("style");t.textContent="\n\t\t\t\t\t.echarts {\n\t\t\t\t\t\t-webkit-tap-highlight-color: transparent;\n\t\t\t\t\t\ttouch-action: pan-x pan-y;\n\t\t\t\t\t\tuser-select: none;\n\t\t\t\t\t\t-webkit-user-select: none;\n\t\t\t\t\t}\n\t\t\t\t",document.head.appendChild(t),this.initCharts(),this.updateCharts()}),300)},methods:{toggleTheme(){this.isDarkTheme=!this.isDarkTheme,this.updateChartsTheme()},updateChartsTheme(){this.isDarkTheme;const t=this.isDarkTheme?"#fff":"#333",e=this.isDarkTheme?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.08)",a=this.isDarkTheme?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.03)",r=this.isDarkTheme?["rgba(255,255,255,0.02)","rgba(255,255,255,0.04)"]:["rgba(0,0,0,0.01)","rgba(0,0,0,0.02)"];Object.entries(this.charts).forEach((([s,i])=>{i&&i.setOption({title:{textStyle:{color:t}},dataZoom:[{type:"inside",start:0,end:4*this.displayHours/(4*this.totalHours)*100,zoomOnMouseWheel:!1,moveOnMouseMove:!0,moveOnMouseWheel:!1,preventDefaultMouseMove:!0,throttle:0,rangeMode:["value","value"],filterMode:"filter",zoomLock:!0,minSpan:4*this.displayHours/(4*this.totalHours)*100,maxSpan:4*this.displayHours/(4*this.totalHours)*100}],xAxis:{axisLine:{lineStyle:{color:e}},axisLabel:{color:t},axisTick:{lineStyle:{color:e}},splitLine:{lineStyle:{color:a}},splitArea:{areaStyle:{color:r}}},yAxis:{axisLine:{lineStyle:{color:e}},axisLabel:{color:t},axisTick:{lineStyle:{color:e}},splitLine:{lineStyle:{color:a}},splitArea:{areaStyle:{color:r}}}})}))},updateTime(){const t=new Date;this.currentTime=`${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}`},loadData(){const t=(t,e,a)=>Array.from({length:a},(()=>Math.round(10*(t+(Math.random()-.5)*e))/10)),e=Array.from({length:4*this.totalHours},((t,e)=>{const a=Math.floor(e/4),r=e%4*15;return`${String(a).padStart(2,"0")}:${String(r).padStart(2,"0")}`}));this.chartData={heartRate:{times:e,values:t(75,10,4*this.totalHours)},breathingRate:{times:e,values:t(16,4,4*this.totalHours)},temperature:{times:e,values:t(36.5,.5,4*this.totalHours)},snore:{times:e,values:t(30,15,4*this.totalHours)}}},initCharts(){const e={grid:{top:35,right:5,bottom:5,left:5,containLabel:!0},dataZoom:[{type:"inside",start:0,end:4*this.displayHours/(4*this.totalHours)*100,zoomOnMouseWheel:!1,moveOnMouseMove:!0,moveOnMouseWheel:!1,preventDefaultMouseMove:!0,throttle:0,rangeMode:["value","value"],filterMode:"filter",zoomLock:!0,minSpan:4*this.displayHours/(4*this.totalHours)*100,maxSpan:4*this.displayHours/(4*this.totalHours)*100}],tooltip:{trigger:"axis",axisPointer:{type:"line",lineStyle:{color:"rgba(0,0,0,0.1)",width:1,type:"solid"}},backgroundColor:"rgba(255,255,255,0.9)",borderColor:"rgba(0,0,0,0.1)",borderWidth:1,textStyle:{color:"#666",fontSize:12},padding:[8,12]},xAxis:{type:"category",boundaryGap:!0,data:[],axisLine:{show:!0,lineStyle:{color:"rgba(0,0,0,0.08)",width:1}},axisLabel:{color:"#999",fontSize:10,rotate:0,interval:"auto",formatter:t=>t.split(":")[0]+"时"},axisTick:{show:!0,alignWithLabel:!0,lineStyle:{color:"rgba(0,0,0,0.08)",width:1}},splitLine:{show:!0,lineStyle:{color:"rgba(0,0,0,0.03)",type:"dashed",width:1}}},yAxis:{type:"value",axisLine:{show:!0,lineStyle:{color:"rgba(0,0,0,0.08)",width:1}},axisLabel:{color:"#999",fontSize:10,margin:8},axisTick:{show:!0,lineStyle:{color:"rgba(0,0,0,0.08)",width:1}},splitLine:{show:!0,lineStyle:{type:"dashed",color:"rgba(0,0,0,0.03)",width:1}}},series:[{type:"line",smooth:!0,symbol:"circle",symbolSize:4,showSymbol:!1,data:[],areaStyle:{opacity:.15,color:new t.LinearGradient(0,0,0,1,[{offset:0,color:"rgba(0,0,0,0.2)"},{offset:1,color:"rgba(0,0,0,0.05)"}])},lineStyle:{width:2,shadowColor:"rgba(0,0,0,0.1)",shadowBlur:4},emphasis:{focus:"series",itemStyle:{borderWidth:2}},animation:!1,zlevel:1,z:1}]},a=(a,r,s)=>{const i=document.getElementById(a);if(!i)return console.error(`找不到图表容器: ${a}`),null;const o=t.init(i,null,{renderer:"canvas",useDirtyRect:!1,devicePixelRatio:window.devicePixelRatio});return o.setOption({...e,series:[{...e.series[0],name:r,itemStyle:{color:s,borderColor:"#fff",borderWidth:1},areaStyle:{...e.series[0].areaStyle,color:new t.LinearGradient(0,0,0,1,[{offset:0,color:s.replace(")",", 0.2)").replace("rgb","rgba")},{offset:1,color:s.replace(")",", 0.05)").replace("rgb","rgba")}])}}]}),o};this.charts.heartRate=a("heartRateChart","心率","#1890FF"),this.charts.breathingRate=a("breathingRateChart","呼吸","#91CB74"),this.charts.temperature=a("temperatureChart","体温","#FAC858"),this.charts.snore=a("snoreChart","鼾声","#EE6666"),window.addEventListener("resize",this.resizeCharts)},updateCharts(){Object.entries(this.charts).forEach((([t,e])=>{e&&e.setOption({xAxis:{data:this.chartData[t].times},series:[{data:this.chartData[t].values}]})}))},resizeCharts(){Object.values(this.charts).forEach((t=>{t&&t.resize()}))},handleRecordingComplete(t){console.log("录音完成:",t),this.lastRecording=t},addNewData(t,e){const a=new Date,r=`${String(a.getHours()).padStart(2,"0")}:${String(a.getMinutes()).padStart(2,"0")}`;this.chartData[t].times.push(r),this.chartData[t].values.push(e),this.chartData[t].times.length>this.totalHours&&(this.chartData[t].times.shift(),this.chartData[t].values.shift()),this.charts[t].setOption({xAxis:{data:this.chartData[t].times},series:[{data:this.chartData[t].values}]})},formatTime(t){const e=new Date(t);return`${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`}},onUnload(){this.timer&&clearInterval(this.timer),window.removeEventListener("resize",this.resizeCharts),Object.values(this.charts).forEach((t=>{t&&t.dispose()}))}};const a=t._export_sfc(e,[["render",function(e,a,r,s,i,o){return{a:t.t(i.isDarkTheme?"🌙":"☀️"),b:t.o(((...t)=>o.toggleTheme&&o.toggleTheme(...t))),c:i.isDarkTheme?1:""}}]]);wx.createPage(a);
