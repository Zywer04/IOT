"use strict";const t=require("../../common/vendor.js"),e={components:{AudioRecorder:()=>"../../components/audio-recorder/audio-recorder.js"},data:()=>({isDarkTheme:!1,recordings:[{timestamp:Date.now()-72e5,duration:7200,size:2097152,snoreData:{count:45,details:[{time:1200,intensity:65,duration:3},{time:1800,intensity:70,duration:2},{time:2400,intensity:68,duration:4}],averageIntensity:67.5}},{timestamp:Date.now()-864e5,duration:3600,size:1048576,snoreData:{count:25,details:[{time:600,intensity:62,duration:2},{time:1200,intensity:68,duration:3},{time:1800,intensity:65,duration:2}],averageIntensity:65}},{timestamp:Date.now()-1728e5,duration:5400,size:1572864,snoreData:{count:35,details:[{time:900,intensity:70,duration:3},{time:1800,intensity:65,duration:2},{time:2700,intensity:72,duration:4}],averageIntensity:69}}],audioContext:null,maxDisplayRecords:5,mockData:{snoreFrequency:{min:2,max:8},snoreIntensity:{min:45,max:75},snoreDuration:{min:1,max:5}}}),onLoad(){this.audioContext=t.index.createInnerAudioContext(),this.loadRecordings()},methods:{loadRecordings(){const e=t.index.getStorageSync("recordings")||[];this.recordings=e},saveRecordings(){t.index.setStorageSync("recordings",this.recordings)},handleRecordingComplete(t){const e=this.generateMockSnoreData(t.duration);this.recordings.unshift({...t,timestamp:Date.now(),snoreData:e}),this.saveRecordings()},handleRecordingError(e){console.error("录音错误：",e),t.index.showToast({title:"录音失败："+e.message,icon:"error"})},generateMockSnoreData(t){const e=t/60,o=Math.floor(e*(Math.random()*(this.mockData.snoreFrequency.max-this.mockData.snoreFrequency.min)+this.mockData.snoreFrequency.min)),n=[];let i=0;for(let r=0;r<o;r++){const e=Math.random()*(this.mockData.snoreIntensity.max-this.mockData.snoreIntensity.min)+this.mockData.snoreIntensity.min,o=Math.random()*(this.mockData.snoreDuration.max-this.mockData.snoreDuration.min)+this.mockData.snoreDuration.min,r=Math.random()*t;n.push({time:r,intensity:e,duration:o}),i+=e}return{count:o,details:n,averageIntensity:o>0?i/o:0}},formatTime(t){const e=Math.floor(t/3600),o=Math.floor(t%3600/60),n=Math.floor(t%60);return e>0?`${e}小时${o}分${n}秒`:o>0?`${o}分${n}秒`:`${n}秒`},formatDate(t){const e=new Date(t);return`${e.getMonth()+1}月${e.getDate()}日 ${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}`},formatRecordingInfo(t){var e,o;return{date:this.formatDate(t.timestamp),duration:this.formatTime(t.duration),size:`${(t.size/1024).toFixed(1)} KB`,snoreInfo:`${(null==(e=t.snoreData)?void 0:e.count)||0}次 (平均${(null==(o=t.snoreData)?void 0:o.averageIntensity.toFixed(1))||0}分贝)`}},playRecording(t){this.audioContext&&(this.audioContext.stop(),this.audioContext.src=t.tempFilePath,this.audioContext.play())},deleteRecording(e){t.index.showModal({title:"确认删除",content:"确定要删除这条录音记录吗？",success:o=>{if(o.confirm){const o=this.recordings[e];t.index.removeSavedFile({filePath:o.tempFilePath,complete:()=>{this.recordings.splice(e,1),this.saveRecordings()}})}}})},toggleTheme(){this.isDarkTheme=!this.isDarkTheme,t.index.setStorageSync("theme",this.isDarkTheme?"dark":"light")}},onUnload(){this.audioContext&&(this.audioContext.stop(),this.audioContext.destroy())}};if(!Array){t.resolveComponent("audio-recorder")()}Math;const o=t._export_sfc(e,[["render",function(e,o,n,i,r,a){return t.e({a:t.t(r.isDarkTheme?"🌞":"🌙"),b:t.o(((...t)=>a.toggleTheme&&a.toggleTheme(...t))),c:t.o(a.handleRecordingComplete),d:t.o(a.handleRecordingError),e:t.p({"is-dark-theme":r.isDarkTheme}),f:t.t(r.maxDisplayRecords),g:r.recordings.length>0},r.recordings.length>0?{h:t.f(r.recordings.slice(0,r.maxDisplayRecords),((e,o,n)=>({a:t.t(a.formatRecordingInfo(e).date),b:t.t(a.formatRecordingInfo(e).duration),c:t.t(a.formatRecordingInfo(e).size),d:t.t(a.formatRecordingInfo(e).snoreInfo),e:e.timestamp})))}:{},{i:r.isDarkTheme?1:""})}]]);wx.createPage(o);
